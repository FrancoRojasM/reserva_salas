@using Microsoft.AspNetCore.Http

@using System.Configuration
@if (@Context.Session.GetString("NombreEmpleadoPerfil") != null)
{
    <!DOCTYPE html>
    <html lang="es-pe">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <meta name="SIA2.0" content="@Context.Session.GetString("NombreEmpresa")" />
        <meta name="author" content="H. Lucas" />

        <title>@MatrixUtilitarios.DatosGlobales.NombreSoftware</title>

        <link href="~/Content/img/favicon.ico" rel="shortcut icon">
        <link href="~/Content/assets/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" />
        <link href="~/Content/themify-icons/themify-icons.css" rel="stylesheet" />
        <link href="~/Content/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <link href="~/Lib/font-awesome/css/all.min.css" rel="stylesheet" />
        <link href="~/Content/ionicons/css/ionicons.min.css" rel="stylesheet" />
        <link href="~/Content/img/favicon.ico" rel="shortcut icon">
        <!--bootstrap -->
        <link href="~/Content/bootstrap/css/bootstrap.css" rel="stylesheet" />

        <!-- animation -->
        <link href="~/Content/assets/css/pages/animate_page.css" rel="stylesheet" />
        <!-- Template Styles -->
        <link href="~/Content/assets/css/style.css" rel="stylesheet" type="text/css" />

        <link href="~/Content/assets/css/responsive.css" rel="stylesheet" type="text/css" />
        <link href="~/Content/assets/css/theme-color.css" rel="stylesheet" type="text/css" />
        <link href="~/Content/dropify/dist/css/dropify.min.css" rel="stylesheet" />
        <link href="~/Content/toastr/toastr.css" rel="stylesheet" />
        <link href="~/Content/css/core.css" rel="stylesheet" />
        <link href="~/Content/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
        <link href="~/Content/datatables/datatables.min.css" rel="stylesheet" />
        <link href="~/Content/datatables/select.dataTables.min.css" rel="stylesheet" />

        <link href="~/Content/select2/dist/css/select2.min.css" rel="stylesheet" />
        <link href="~/Content/select2/dist/css/select2-bootstrap.css" rel="stylesheet" />

        <link href="~/Content/bootstrap-multiselect/css/bootstrap-multiselect.css" rel="stylesheet" />


        <link href="~/Content/css/jqwidgets/jqx.base.css" rel="stylesheet" />
        <link href="~/Content/css/label/label.min.css" rel="stylesheet" />
        <link href="~/Content/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
        <link href="~/Content/assets/plugins/material/material.min.css" rel="stylesheet" />
        <link href="~/Content/assets/css/material_style.css" rel="stylesheet" />
        <link href="~/Content/daterangepicker/daterangepicker.css" rel="stylesheet" />
        <link href="~/Content/gantt/dist/jsgantt.css" rel="stylesheet" />
        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">


        @*<link href="~/Content/bootstrap/css/ParpadeoHoja.css" rel="stylesheet" />*@
        @RenderSection("styles", required: false)
        <style>
            .modal-header {
                background-color: #950606 !important;
            }

            .toast-success {
                background-color: #950606;
            }
            /* Tamaño del scroll */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            /* Estilos barra (thumb) de scroll */
            ::-webkit-scrollbar-thumb {
                background: #950606;
                border-radius: 0px;
            }

                ::-webkit-scrollbar-thumb:active {
                    background-color: rgba(255,255,255,.7);
                }

                ::-webkit-scrollbar-thumb:hover {
                    background: #950606;
                    box-shadow: 0 0 2px 1px rgba(255,255,255,.7);
                }

            /* Estilos track de scroll */
            ::-webkit-scrollbar-track {
                background: rgb(164 159 160);
                border-radius: 0px;
            }

                ::-webkit-scrollbar-track:hover,
                ::-webkit-scrollbar-track:active {
                    background: rgb(164 159 160);
                }

            .modal-header {
                cursor: move;
            }

            .LabelError {
                background: white;
                color: red;
                font-weight: bolder;
            }

            .ListaError {
                position: absolute;
                float: right;
                z-index: 10;
                background-color: #950606e3 !important;
                border-color: #950606 !important;
                color: #fff !important;
                font-size: 10px;
                display: inline-block;
                vertical-align: baseline;
                margin: 1px;
                text-transform: none;
                font-weight: 700;
                border: 0 solid transparent;
                border-radius: 0.2rem;
                -webkit-transition: background .1s ease;
                transition: background .1s ease;
            }

                .ListaError > ul {
                    line-height: 1;
                    font-size: 12px;
                    list-style-type: none;
                    padding: 10px 5px 0px 5px;
                }
        </style>
    </head>

    <body id="bodyPrincipal" class="page-header-fixed sidemenu-closed-hidelogo page-content-white page-md header-dark dark-sidebar-color logo-dark dark-theme" style="background-color: #950606;">
        <div id="addComponent"></div>
        <input type="hidden" id="argumentos" value="" />
        <div class="page-wrapper">
            <div class="page-header navbar navbar-fixed-top" style="background-color: #950606">
                <div class="page-header-inner ">
                    <div class="page-logo" style="background-color: #950606;">
                        <a href='@Url.Action("Cuenta","Usuario")'>
                            <img style="height:40px;" alt="" src="@ConfigurationManager.AppSettings["HostImagenes"]LogoInstitucion.png" class="img-circle" />
                            <span class="logo-default" style="font-size:12px">@MatrixUtilitarios.DatosGlobales.NombreSoftware</span>
                        </a>
                    </div>
                    <ul class="nav navbar-nav navbar-left in">
                        <li><a class="menu-toggler sidebar-toggler"><i class="icon-menu"></i></a></li>
                    </ul>
                    <a class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
                        <span></span>
                    </a>
                    <div class="top-menu">
                        <ul class="nav navbar-nav pull-right">
                            <li class="dropdown dropdown-user">
                                <a class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" aria-expanded="false">
                                    @{
                                        string cargo = Context.Session.GetString("Cargo");
                                        if (Context.Session.GetString("IdCatalogoTipoEmpleado") == "9")
                                        {
                                            cargo = Context.Session.GetString("CatalogoTipoEmpleado");
                                        }

                                        string AreaCargo = Context.Session.GetString("Area") + " - " + cargo;
                                        if (Context.Session.GetString("Area") == "null" || Context.Session.GetString("Area").ToString() == "") { AreaCargo = "USUARIO EXTERNO"; }
                                    }
                                    <span style="margin: 5px 0px 0px 0px;" class="username username-hide-on-mobile"> @AreaCargo</span>
                                    @*<img alt="" class="img-circle" style="height: 35px;" id="imgFotoUsuario" src="@ConfigurationManager.AppSettings["HostImagenes"]@Context.Session.GetString("RutaFotoUsuario").ToString()" />*@
                                </a>
                                <ul class="dropdown-menu dropdown-menu-default jello">
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("Cuenta", "Usuario")">
                                            <i class="icon-user"></i> Perfil
                                        </a>
                                    </li>
                                    <li class="divider"> </li>
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("CerrarSesion", "Usuario")"><i class="icon-logout"></i> Cerrar sesión</a>
                                    </li>
                                </ul>

                            </li>
                        </ul>

                    </div>
                </div>
            </div>
            <div class="page-container" style="background-color: #950606;">
                <div class="sidebar-container">
                    <div class="sidemenu-container navbar-collapse collapse fixed-menu">
                        <div id="remove-scroll">
                            <ul id="DivMenuPrincipal" class="sidemenu page-header-fixed p-t-10" style="background-color: #950606" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
                                <li class="sidebar-user-panel">
                                    <div class="user-panel" style="padding: 0px 3px 0px 0px!important;">
                                        @if (Context.Session.GetString("NombreSede").ToString() != "null" && Context.Session.GetString("NombreSede").ToString() != "")
                                        {
                                            <div class="profile-usertitle" style="margin:7px!important;">
                                                <div class="sidebar-userpic-name" style="background-color: #fff; color: #950606; padding: 10px; border-radius: 4px; "><span style="vertical-align: sub;font-size:20px;">@Context.Session.GetString("NombreSede").ToString()</span></div>
                                            </div>
                                        }
                                        <div class="row">
                                            <div class="sidebar-userpic">
                                                <img class="img-responsive" style="height: 80px;" id="imgFotoPrincipalUsuario" src="@ConfigurationManager.AppSettings["HostImagenes"]@Context.Session.GetString("RutaFotoUsuario").ToString()" alt="">
                                            </div>
                                        </div>

                                        <div class="profile-usertitle">
                                            <div class="sidebar-userpic-name" style="color: #fff"> @Context.Session.GetString("NombreCompleto").ToString() </div>
                                        </div>

                                    </div>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link nav-toggle" style="background-color: #950606!important;">
                                        <i class="ti-home"></i>
                                        <span class="title">Inicio</span>
                                        <span class="arrow"></span>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="nav-item">
                                            <a style="background-color: #950606;" href='@Url.Action("ActualizarMenu", "Usuario", new { Controlador="",Vista=""})' class="nav-link nav-toggle">
                                                <span class="title">Actualizar permisos</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a style="background-color: #950606;" href='@Url.Action("Cuenta", "Usuario")' class="nav-link nav-toggle">
                                                <span class="title">Mi Perfil</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a style="background-color: #950606;" href='@Url.Action("CerrarSesion", "Usuario")' class="nav-link nav-toggle">
                                                <span class="title">Cerrar sesión</span>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                @Html.Raw(Context.Session.GetString("MenuPrincipal"))
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="page-content-wrapper" style="background-color: #950606">
                    <div class="page-content">
                        <div id="divCargador" class="mdl-progress mdl-js-progress mdl-progress__indeterminate is-upgraded" data-upgraded=",MaterialProgress">
                            <div class="progressbar bar bar1" style="width: 0%; background-color: #950606"></div>
                            <div class="bufferbar bar bar2" style="width: 100%; background-image: linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,rgb(241 9 60),rgb(236 8 51))"></div>
                            <div class="auxbar bar bar3" style="width: 0%; background-image: linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,rgb(63,81,181),rgb(63,81,181))"></div>
                        </div>

                        <div class="page-bar" style="background-color:white;">
                            <div class="page-title-breadcrumb">
                                <div class=" pull-left">
                                    @if (Context.Session.GetString("SubPaginaActual") == "null" || Context.Session.GetString("SubPaginaActual").ToString() == "")
                                    {
                                        <div class="page-title">@Context.Session.GetString("PaginaActual")</div>
                                    }
                                    else
                                    {
                                        <div class="page-title">@Context.Session.GetString("SubPaginaActual")</div>
                                    }
                                </div>
                                @if (Context.Session.GetString("SubPaginaActual") == "null" || Context.Session.GetString("SubPaginaActual").ToString() == "")
                                {
                                    <ol class="breadcrumb page-breadcrumb pull-right" style="border-radius: 3px;">
                                        <li>
                                            @Context.Session.GetString("ModuloActual")<i class="fa fa-angle-right"></i>
                                        </li>
                                        <li class="active">@Context.Session.GetString("PaginaActual")</li>
                                    </ol>
                                }
                                else
                                {
                                    <ol class="breadcrumb page-breadcrumb pull-right">
                                        <li>
                                            @Context.Session.GetString("ModuloActual")<i class="fa fa-angle-right"></i>
                                        </li>
                                        <li>@Context.Session.GetString("PaginaActual")<i class="fa fa-angle-right"></i></li>
                                        <li class="active">@Context.Session.GetString("SubPaginaActual")</li>
                                    </ol>
                                }
                            </div>
                        </div>
                        @RenderBody()

                    </div>
                </div>
            </div>
            <div class="modal fade centered-modal" id="ModalSesionAutenticada">
                <div class="modal-dialog modal-se">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a href="#" onclick="CerrarModalSesionAutenticada()" class="close">x</a>
                            <h4 class="modal-title" id="modalPedidoParaDevolucionLabel">Cambio de Perfil</h4>
                        </div>
                        <div class="modal-body">
                            <div id="divCambioPerfil">
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <div class="page-footer" style="background-color: #950606">
                <div class="page-footer-inner">
                    <span>  @DateTime.Now.Year ® @MatrixUtilitarios.DatosGlobales.NombreSoftware - @MatrixUtilitarios.DatosGlobales.NombreInstitucionLargo ®</span>
                </div>
                <div class="scroll-to-top">
                    <i class="icon-arrow-up"></i>
                </div>
            </div>
        </div>

        <div id="sound"></div>

        <script src="~/Content/jquery/jquery-1.12.3.min.js"></script>
        <!--<script src="~/Content/Multiple-Dates-Picker/jquery-ui.multidatespicker.js"></script>
            <link href="~/Content/Multiple-Dates-Picker/jquery-ui.multidatespicker.css" rel="stylesheet" />-->
        <script src="~/Content/tether/js/tether.min.js"></script>
        <script src="~/Content/assets/plugins/popper/popper.min.js"></script>
        <script src="~/Content/assets/plugins/jquery-blockui/jquery.blockui.min.js"></script>
        <script src="~/Content/assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script src="~/Content/bootstrap/js/bootstrap.min.js"></script>
        <script src="~/Content/dropify/dist/js/dropify.min.js"></script>
        <script src="~/Content/toastr/toastr.min.js"></script>
        <script src="~/Content/html5-form-validation/jquery.validation.min.js"></script>
        <script src="~/Content/sweetalert2/sweetalert2.min.js"></script>
        <script src="~/Content/datatables/datatables.min.js"></script>

        <script src="~/Content/datatables/vfs_fonts.js"></script>

        <script src="~/Content/select2/dist/js/select2.min.js"></script>
        <script src="~/Content/js/jqwidgets/jqxcore.js"></script>
        <script src="~/Content/js/jqwidgets/jqxdata.js"></script>
        <script src="~/Content/js/jqwidgets/jqxinput.js"></script>
        <script src="~/Content/moment/moment.js"></script>
        <script src="~/Content/bootstrap-multiselect/js/bootstrap-multiselect.js"></script>

        <script src="~/Content/assets/js/app.js"></script>
        <script src="~/Content/assets/js/layout.js"></script>
        <script src="~/Content/assets/js/theme-color.js"></script>

        <script src="~/Content/assets/js/pages/ui/animations.js"></script>
        <script src="~/Content/assets/plugins/material/material.min.js"></script>
        <script src="~/Content/bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>

        <script src="~/Content/bootstrap-datepicker/dist/locales/bootstrap-datepicker.es.min.js"></script>
        <script type="text/javascript" src="https://dsp.reniec.gob.pe/refirma_invoker/resources/js/client.js"></script>
        <script src="~/Content/datatables/dataTables.select.min.js"></script>
        <script src="~/Content/daterangepicker/daterangepicker.min.js"></script>

        <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <script src="~/Content/pdfjs/pdf.js"></script>
        <script src="~/Content/gantt/dist/jsgantt.js"></script>
        <script src="~/Content/html2canvas/html2canvas.js"></script>
        <script src="~/Content/js/cryptojs/md5.js"></script>
        <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
        <script src="https://cdn.ckeditor.com/ckeditor5/37.1.0/classic/ckeditor.js"></script>

        @RenderSection("scripts", required: false)

        <script>

            function formatoNumeroMiles(e) {
                //para usarlo debe colocar la clase formatoNumeroMiles en el control text
                if (this.value.trim() == "" || this.value.trim() == "-") {
                    return;
                }

                // Obtenemos un array con el numero y los decimales si hay
                let contenido = this.value.replace(/[^0-9\.]/g, "").split(".");

                // añadimos los separadores de miles al primer numero del array
                contenido[0] = contenido[0].length ? new Intl.NumberFormat('en-US').format(parseInt(contenido[0])) : "0";

                // Juntamos el numero con los decimales si hay decimales
                let resultado = contenido.length > 1 ? contenido.slice(0, 2).join(".") : contenido[0];
                this.value = this.value[0] == "-" ? "-" + resultado : resultado;
            }

            var $loading = $('#divCargador').hide();
            $(document)
                .ajaxStart(function () {
                    $loading.show();
                })
                .ajaxStop(function () {
                    $loading.hide();
                });

            function MaximoNumeroCaracteres(limitField, limitNum) {
                if (limitField.value.length > limitNum) {
                    limitField.value = limitField.value.substring(0, limitNum);
                }
            }
            $(function () {

               
                // Jquery draggable
                $('.modal-dialog').draggable({
                    handle: ".modal-header"
                });

                setInterval(function () {
                    ValidarSesionActivaUsuario();
                }, 5000);

            });
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "show",//"fadeIn",
                "hideMethod": "hide"//"fadeOut"
            }
            function ValidarSesionActual(error, thrown) {
                if (error == 'error' || thrown == 500 || thrown == 403 || thrown == 'Forbidden') {
                    swal({
                        title: 'Alerta',
                        text: 'Por seguridad hemos caducado la sesión, esta ventana se cerrará automaticamente en 5 segundos, vuelva a ingresar con su usuario y contraseña.',
                        timer: 5000,
                        onOpen: function () {
                            swal.showLoading()
                        }
                    }).then(
                        function () {
                            window.location.href = "@Url.Action("Login", "Usuario")";
                        },
                        function (dismiss) {
                            if (dismiss === 'timer') {
                                window.location.href = "@Url.Action("Login", "Usuario")";
                            }
                        })
                }
            }
            function ValidarSesionActivaUsuario() {
                $.ajax({
                    url: "@Url.Action("ping", "Modulo")",
                    //data: { data: @Context.Session.GetString("IdEmpleadoPerfil")},
                    method: 'GET',
                    global: false,
                    success: function (respuesta) {
                        if (respuesta == -1) {
                            window.location.replace('@Url.Action("ActualizarMenu", "Usuario")');
                        }
                    },
                    error: function (mensaje, error, thrown) {
                        ValidarSesionActual(error, thrown);
                    }
                });
            }



            function ponerReadOnly(id) {
                $("#" + id).attr("readonly", "readonly");
                $("#" + id).addClass("readOnly");
            }

            function quitarReadOnly(id) {
                $("#" + id).removeAttr("readonly");
                $("#" + id).removeClass("readOnly");
            }
            function ponerVisible(id) {
                $("#" + id).attr("hidden", "false");
                $("#" + id).addClass("hidden");
            }

            function quitarVisible(id) {
                $("#" + id).removeAttr("hidden");
                $("#" + id).removeClass("hidden");
            }
            function soloNumero(e) {
                var key = window.Event ? e.which : e.keyCode;
                console.log(key);
                if ((key == 45) || (key == 43)) return false;

                return ((key == 0) || (key >= 48 && key <= 57) || (key == 8) || (key == 46))
            }

            function soloNumeroEnteros(e) {
                var key = window.Event ? e.which : e.keyCode

                if (key == 0) return true;
                return ((key == 0) || (key >= 48 && key <= 57) || (key == 8))
            }

            function right(str, chr) {
                return str.slice(str.length - chr, str.length);
            }

            function left(str, chr) {
                return str.slice(0, chr - str.length);
            }
            function sumarDias(fecha, dias) {
                var dia = fecha.substring(0, 2);
                var mes = fecha.substring(3, 5);
                var periodo = fecha.substring(6, 10);
                var fechaarmada = periodo + '-' + mes + '-' + dia;
                var fechanueva = new Date(fechaarmada);
                fechanueva.setDate(fechanueva.getDate() + 1 + parseInt(dias));
                console.log(fechanueva);
                mes = fechanueva.getMonth() + 1;
                dia = fechanueva.getDate();
                periodo = fechanueva.getFullYear();

                return right('00' + dia, 2) + '/' + right('00' + mes, 2) + '/' + periodo;
            }
            function intlRound(numero, decimales = 2, usarComa = false) {
                var opciones = {
                    maximumFractionDigits: decimales,
                    useGrouping: false
                };
                usarComa = usarComa ? "es" : "en";
                return new Intl.NumberFormat(usarComa, opciones).format(numero);
            }
            function ValidarCaracterEspecial(value) {
                value = value.toLowerCase();
                console.log(value);
                if (value.indexOf('#') != -1) { return false; }
                else if (value.indexOf('!') != -1) { return false; }
                else if (value.indexOf('$') != -1) { return false; }
                else if (value.indexOf('%') != -1) { return false; }
                else if (value.indexOf('/') != -1) { return false; }
                else if (value.indexOf('=') != -1) { return false; }
                else if (value.indexOf('?') != -1) { return false; }
                else if (value.indexOf('¡') != -1) { return false; }
                else if (value.indexOf('¿') != -1) { return false; }
                else if (value.indexOf("'") != -1) { return false; }
                else if (value.indexOf('´') != -1) { return false; }
                else if (value.indexOf('*') != -1) { return false; }
                else if (value.indexOf('{') != -1) { return false; }
                else if (value.indexOf('}') != -1) { return false; }
                else if (value.indexOf('+') != -1) { return false; }
                else if (value.indexOf('"') != -1) { return false; }
                else if (value.indexOf('”') != -1) { return false; }
                else if (value.indexOf('“') != -1) { return false; }
                else if (value.indexOf('|') != -1) { return false; }
                else if (value.indexOf('á') != -1) { return false; }
                else if (value.indexOf('é') != -1) { return false; }
                else if (value.indexOf('í') != -1) { return false; }
                else if (value.indexOf('ó') != -1) { return false; }
                else if (value.indexOf('ú') != -1) { return false; }

                else { return true; }
            }

        </script>
    </body>
    </html>
}




